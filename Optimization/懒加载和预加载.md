# 懒加载

以图片为例，当图片进入用户的可视化区域的时候，才会去加载图片资源，懒加载的优点在于：

1. 减少无效资源的加载，很多瀑布流中的资源并不一定是用户想要的。懒加载的话可以减少用户的流量也可以减少服务器的压力。
2. 过多的并发资源加载会阻塞JS的加载，影响网站的使用。

懒加载非常适用于瀑布流布局的页面。

### 实例

```html
<!DOCTYPE html>
<html>
<head>
  <title>lazy load</title>
  <style type="text/css">
    .image-item{
      height: 500px;
      width: 400px;
      background-color: #233;
    }
  </style>
</head>
<body>
  <div class="image-list">
    <img src="" class="image-item" lazyload="true" data-original="./image/1.jpg">
    <img src="" class="image-item" lazyload="true" data-original="./image/2.jpg">
    <img src="" class="image-item" lazyload="true" data-original="./image/3.jpg">
    <img src="" class="image-item" lazyload="true" data-original="./image/4.jpg">
    <img src="" class="image-item" lazyload="true" data-original="./image/5.jpg">
    <img src="" class="image-item" lazyload="true" data-original="./image/6.jpg">
  </div>
  <script>
    var viewHeight = document.documentElement.clientHeight;
    function lazyload () {
      var eles = document.querySelectorAll('img[lazyload][data-original]');
      Array.prototype.forEach.call(eles, function (item, index) {
        var rect;
        if(item.dataset.original === '')
          return
        rect = item.getBoundingClientRect(); // 获取元素相对于可视区域的左上角的位置
        if(rect.top < viewHeight && rect.bottom >= 0) {
          !function (){
            var img = new Image();
            img.src = item.dataset.original;
            img.onload = function () {
              // 将下载好的图片加载到对应的img标签中
              item.src = img.src;
            }
            item.removeAttribute('data-original');
            item.removeAttribute('lazyload');
          }();
        }
      });
    }
    lazyload(); // 先运行一次是为了加载顶部的图片。
    document.addEventListener('scroll', lazyload);
  </script>
</body>
</html>
```





# 预加载

还是以图片为例，一些需要立即显示的图片可以在使用之前提前请求放入缓存中，预加载的优点是：

1. 资源从缓存中加载，使得图片加载获取得更快，提升用户体验

预加载的应用场景，比如说：我们需要做一个动画效果，动画是几个图片连续切换完成，如果没有预加载，每次都是直接从服务器拿图片的话，可能会导致当前图片已经不再使用而图片的加载却还没有完成。这个时候就可以使用预加载了。

###预加载的方式主要有三种：

1. 通过DOM元素预加载，创建img标签但是不显示，要用到的时候直接从缓存中拿图片

   ```html
   <!DOCTYPE html>
   <html>
   <head>
     <title>pre load</title>
     <style type="text/css">
       .image-item{
         display:none;
       }
     </style>
   </head>
   <body>
     <div class="image-list">
       <img class="image-item" src="./image/1.jpg">
       <img class="image-item" src="./image/2.jpg">
       <img class="image-item" src="./image/3.jpg">
       <img class="image-item" src="./image/4.jpg">
       <img class="image-item" src="./image/5.jpg">
       <img class="image-item" src="./image/6.jpg">
     </div>
   </body>
   </html>
   ```

2. 使用JavaScript，创建一个Image对象。

   ```html
   <!DOCTYPE html>
   <html>
   <head>
     <title>pre load</title>
   </head>
   <body>
     <script>
       !function () {
         for(var i = 0; i < 6; i++) {
           var img = new Image();
           img.src = `./image/${i + 1}.jpg`;
         }
       }();
     </script>
   </body>
   </html>
   ```

3. 使用ajax请求，优点是精确控制，但是会造成跨域的问题。